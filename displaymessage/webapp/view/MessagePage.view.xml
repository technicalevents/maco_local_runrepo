<mvc:View controllerName="com.sap.cd.maco.monitor.ui.app.displaymessages.view.MessagePage"
  xmlns="sap.m" 
  xmlns:mvc="sap.ui.core.mvc" 
  xmlns:c="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
  xmlns:core="sap.ui.core" 
  xmlns:uxap="sap.uxap"
  xmlns:reuseButton="com.sap.cd.maco.mmt.ui.reuse.control.button"
  xmlns:reuseTable="com.sap.cd.maco.mmt.ui.reuse.control.table"
  xmlns:smartForm="sap.ui.comp.smartform"
  xmlns:smartTable="sap.ui.comp.smarttable"
  xmlns:smartField="sap.ui.comp.smartfield">
  <uxap:ObjectPageLayout
    id="objectPage"
    useIconTabBar="false"
    upperCaseAnchorBar="false">
    <uxap:headerTitle>
      <uxap:ObjectPageDynamicHeaderTitle>
        <uxap:expandedHeading>
          <Title text="{ExternalUUID}" wrapping="true"/>
        </uxap:expandedHeading>
        <uxap:snappedHeading>
          <Title text="{ExternalUUID}" wrapping="true"/>
        </uxap:snappedHeading>
        <uxap:expandedContent>
          <Text text="{parts: [{path: 'i18n>FORMAT_AMID_TXT_LBL'},
                                      {path: 'TechnicalMsgID'},
                                      {path: 'ExtBusinessMessageID'}],
                                      formatter: '.formatter.formatMessage'}" />
        </uxap:expandedContent>
        <uxap:snappedContent>
          <Text text="{parts: [{path: 'i18n>FORMAT_AMID_TXT_LBL'},
                                      {path: 'TechnicalMsgID'},
                                      {path: 'ExtBusinessMessageID'}],
                                      formatter: '.formatter.formatMessage'}" />
        </uxap:snappedContent>
        <uxap:actions>
			<Button text="{i18n>DOWNLOAD_BTN_TXT}"
					type="Transparent"
					press="onAction"
					enabled="{this>/tableActionEnabled/singleDownload}"
					c:action="singleDownload" />
			<Button visible="{this>/ExternalPayload/LoadCompMsgBtnVisible}" 
					text="{i18n>LOAD_COMP_MSG_TXT}" 
					press="onLoadCompleteMessage"
					type="Transparent">
			</Button>
			<reuseButton:Share icon="sap-icon://action"
				               press="onAction" 
				               c:action="share" />
        </uxap:actions>
        <uxap:breadcrumbs>
        </uxap:breadcrumbs>
      </uxap:ObjectPageDynamicHeaderTitle>
    </uxap:headerTitle>
    <uxap:headerContent>
      <core:Fragment type="XML" fragmentName="com.sap.cd.maco.monitor.ui.app.displaymessages.view.MessageHeader"/>
    </uxap:headerContent>
    <uxap:sections>
    	<uxap:ObjectPageSection title="{i18n>MSG_PROPERTIES_TITLE}" titleUppercase="false">
        	<uxap:subSections>
            	<uxap:ObjectPageSubSection>
            		<uxap:blocks>
						<smartForm:SmartForm>
							<smartForm:layout>
								<core:Fragment type="XML" fragmentName="com.sap.cd.maco.mmt.ui.reuse.fragment.form.SmartFormLayout"/>
							</smartForm:layout>
							<smartForm:Group label="{i18n>MSG_PROPERTIES_GEN_SUBSECTION_TITLE}">
								<smartForm:GroupElement label="{/xMP4GxC_TransferDoc_UI/ProcessDocumentNumber/#@sap:label}" 
														visible="{= ${this>/LinkedDocuments/ProcessDocCount} > 1 ? false : true}">
									<Link text="{this>/LinkedDocuments/ProcessDocument/LinkedDocumentNumber}" 
										  press="onCrossAppNavigation" 
										  c:docType="Process" 
										  wrapping="true"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{/xMP4GxC_TransferDoc_UI/Direction/#@sap:label}">
									<Text text="{Direction_Text}" 
										  wrapping="true"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{/xMP4GxC_TransferDoc_UI/ExternalCommunicationType/#@sap:label}">
									<Text text="{ExternalCommunicationType_Text}" 
										  wrapping="true"/>
								</smartForm:GroupElement>
							</smartForm:Group>
							<smartForm:Group label="{i18n>CONTRL_MSG_TEXT}" 
											 visible="{= !(${TechnicalMsgID} === 'CONTRL' || ${TechnicalMsgID} === 'APERAK')}">
								<smartForm:GroupElement label="{i18n>MSG_REF_TEXT}"
														visible="{= ${this>/LinkedDocuments/ContrlDocCount} > 1 ? true : false}">
									<Link text="{parts: [{path: 'i18n>MULTI_DOCUMENT_TXT'}, 
														 {path: 'this>/LinkedDocuments/ContrlDocCount'}],
                                    			 formatter: '.formatter.formatMessage'}"
										  wrapping="true" 
										  press="onAction"
										  c:boObjectType="CONTRL"
										  c:action="multipleDoc"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{i18n>MSG_REF_TEXT}"
														visible="{= ${this>/LinkedDocuments/ContrlDocCount} > 1 ? false : true}">
									<Link text="{this>/LinkedDocuments/ControlMessage/ExtUUID}"
										  press="onCrossAppNavigation" 
										  c:docType="Message" 
										  wrapping="true"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{i18n>Date_LBL}" 
														visible="{= (!!${this>/LinkedDocuments/ControlMessage/ExtUUID} &amp;&amp; 
																	(${this>/LinkedDocuments/ContrlDocCount} > 1 ? false : true))}">
									<Text text="{path: 'this>/LinkedDocuments/ControlMessage/Timestamp',
									             type: 'sap.ui.model.type.DateTime',
												 formatOptions: {style: 'medium'}}"
										  wrapping="true"/>
								</smartForm:GroupElement>
							</smartForm:Group>
							<smartForm:Group label="{i18n>APERAK_MSG_TEXT}" 
											 visible="{= !(${TechnicalMsgID} === 'CONTRL' || ${TechnicalMsgID} === 'APERAK')}">
								<smartForm:GroupElement label="{i18n>MSG_REF_TEXT}"
														visible="{= ${this>/LinkedDocuments/AperakDocCount} > 1 ? true : false}">
									<Link text="{parts: [{path: 'i18n>MULTI_DOCUMENT_TXT'}, 
														 {path: 'this>/LinkedDocuments/AperakDocCount'}],
                                    			 formatter: '.formatter.formatMessage'}"
										  wrapping="true" 
										  press="onAction"
										  c:boObjectType="APERAK"
										  c:action="multipleDoc"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{i18n>MSG_REF_TEXT}"
														visible="{= ${this>/LinkedDocuments/AperakDocCount} > 1 ? false : true}">
									<Link text="{this>/LinkedDocuments/AperakMessage/ExtUUID}"
										  press="onCrossAppNavigation" 
										  c:docType="Message" 
										  wrapping="true"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{i18n>Date_LBL}" 
														visible="{= (!!${this>/LinkedDocuments/AperakMessage/ExtUUID} &amp;&amp; 
																	(${this>/LinkedDocuments/AperakDocCount} > 1 ? false : true))}">
									<Text text="{path: 'this>/LinkedDocuments/AperakMessage/Timestamp',
										         type: 'sap.ui.model.type.DateTime',
										         formatOptions: { style: 'medium' }}"
										  wrapping="true"/>
								</smartForm:GroupElement>
							</smartForm:Group>
							<smartForm:Group label="{i18n>ORIGINAL_MSG_TEXT}" 
											 visible="{= (${TechnicalMsgID} === 'CONTRL' || ${TechnicalMsgID} === 'APERAK')}">
								<smartForm:GroupElement label="{i18n>MSG_REF_TEXT}">
									<Link text="{this>/LinkedDocuments/OriginalMessage/ExtUUID}"
										  press="onCrossAppNavigation" 
										  c:docType="Message" 
										  wrapping="true"/>
								</smartForm:GroupElement>
								<smartForm:GroupElement label="{i18n>Date_LBL}" 
														visible="{=!!${this>/LinkedDocuments/OriginalMessage/ExtUUID}}">
									<Text text="{path: 'this>/LinkedDocuments/OriginalMessage/Timestamp',
												 type: 'sap.ui.model.type.DateTime',
												 formatOptions: { style: 'medium' }}"
										  wrapping="true"/>
								</smartForm:GroupElement>
							</smartForm:Group>
						</smartForm:SmartForm>
            		</uxap:blocks>
            	</uxap:ObjectPageSubSection>
        	</uxap:subSections>
    	</uxap:ObjectPageSection>
    	<uxap:ObjectPageSection title="{i18n>MSG_DATA_TITLE}" titleUppercase="false">
    		<uxap:subSections>
    			<uxap:ObjectPageSubSection>
    				<uxap:blocks>
    					<TextArea value="{this>/ExternalPayload/InitialExternalPayload}" 
								  editable="false" width="100%" growing="true" growingMaxLines="51">
        				</TextArea>
    			    </uxap:blocks>
        		</uxap:ObjectPageSubSection>
			</uxap:subSections>
		</uxap:ObjectPageSection>
		<uxap:ObjectPageSection title="{i18n>LINKED_PROCESS_DOC_TITLE}" titleUppercase="false" 
								visible="{= ${this>/LinkedDocuments/ProcessDocCount} > 1 ? true : false}">
    		<uxap:subSections>
    			<uxap:ObjectPageSubSection>
    				<uxap:blocks>
    					<smartTable:SmartTable id="idLinkedProcessSmartTable"
					        entitySet="xMP4GxC_GetLinkedPdocDetailsSet"
					        tableType="ResponsiveTable"
					        enableAutoBinding="false" 
					        demandPopin="false"
					        useExportToExcel="false"
					        useTablePersonalisation="false"
					        useVariantManagement="false" 
					        beforeRebindTable="onBeforeRebindTable"
					        dataReceived="onProcessDocDataReceived"
					        requestAtLeastFields="ProcessDocumentKey,StatusCriticality,SemanticType,OwnerUUID"
					        persistencyKey="com.sap.cd.maco.mmt.ui.app.controller.displaymessages.pdoc.table">
					        <Table id="idLinkedProcessTable"
						          growing="true"
						          growingScrollToLoad="true" 
						          growingThreshold="100" 
						          mode="None"
						          sticky="ColumnHeaders,HeaderToolbar" >
					          <columns>
					            <Column width="40%">
					              <Text text="{/xMP4GxC_GetLinkedPdocDetailsSet/ProcessDocumentNumber/#@sap:label}"/>
					              <customData>
					                <core:CustomData key="p13nData" 
					                				 value='\{"columnIndex":"0", 
					                						  "columnKey":"ProcessDocumentNumber", 
					                						  "leadingProperty":["ProcessDocumentNumber", "ProcessIDDescription"] }'/>
					              </customData>
					            </Column>
					          </columns>
					          <items>
					            <ColumnListItem type="Navigation" press="onAction" c:action="navObjectTableToProcessApp">
					              <cells>
					                  <reuseTable:ObjectIdentifier title="{ProcessDocumentNumber}" text="{ProcessIDDescription}"/>
					              </cells>
					            </ColumnListItem>
					          </items>
					        </Table>
					      </smartTable:SmartTable>
    			    </uxap:blocks>
        		</uxap:ObjectPageSubSection>
			</uxap:subSections>
		</uxap:ObjectPageSection>
    </uxap:sections>
  </uxap:ObjectPageLayout>
</mvc:View>
